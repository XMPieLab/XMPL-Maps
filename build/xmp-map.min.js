!function(e){"use strict";function o(e,o){var t;return e.currentStyle?t=e.currentStyle[o]:window.getComputedStyle&&(t=document.defaultView.getComputedStyle(e,null).getPropertyValue(o)),t}function t(e){"block"!=o(e[0],"display")&&e.css("display","block"),o(e[0],"height").match(/^(0|auto)/)&&e.css("height","300px")}function r(e,o,t){var r=o.split("."),n=r.length-1,i=e;r.forEach(function(e,o){return o==n?void(i[e]="zoom"==e?parseInt(t):t):("undefined"==typeof i[e]&&(i[e]={}),void(i=i[e]))})}function n(e,o){var t=[{width:"width"},{height:"height"},{routeOrigin:"route.origin.address"},{routeDestination:"route.destination.address"},{pin:"pin.address"},{center:"center.address"},{zoom:"zoom"},{geocodingApiKey:"geocoding_api_key"},{mapStyles:"styles"}];t.map(function(t){for(var n in t)"undefined"!=typeof e[n]&&r(o,t[n],e[n])})}window.__google_api_loaded_for_xmp_map__=function(){window.__google_api_xmp_map_loaded__=!0;var o=e.element(document.body).scope().$root;o.$broadcast("map-api-ready")},$(function(){$.getScript("http://maps.google.com/maps/api/js?callback=__google_api_loaded_for_xmp_map__").fail(function(e){console.log("XMP MAP - Could not load Google Map script: "+e)})}),e.module("xmp.app").directive("xmpMap",["xmpMapDirectionService","xmpMapMarkersService","xmpMapAddressesService","$window",function(o,r,i,a){return{restrict:"A",link:function(s,d,p){function c(e,t){return t.routeIcons?void o.setRoute(e,t.route,t.routeIcons):void o.setRoute(e,t.route)}function u(o,t){var n=new google.maps.Map(t,o);s.map=n,o.route&&n.addListener("idle",function(){var t=[];o.route.origin.address&&t.push(o.route.origin.address),o.route.destination.address&&t.push(o.route.destination.address),2==t.length?i.getAddressList(t,o.geocoding_api_key).then(function(t){e.extend(o.route.origin,t[0]),e.extend(o.route.destination,t[1]),c(n,o)}):c(n,o)}),o.pin&&(o.pin.address?i.getAddress(o.pin.address,o.geocoding_api_key).then(function(t){e.extend(o.pin,t),r.createMarker(n,o.pin,o.pin.icon)}):r.createMarker(n,o.pin,o.pin.icon))}function g(){t(d),d.empty();var o=document.createElement("div");o.style.width="100%",o.style.height="100%",d.prepend(o);var r={center:{lat:0,lng:0},zoom:15};["width","height","geocodingApiKey"].map(function(e){s[e]=p[e]}),["options","routeOrigin","routeDestination","zoom","pin","center","mapStyles"].map(function(e){s[e]=s.$eval(p[e])}),s.options&&e.extend(r,s.options),n(s,r),["width","height"].map(function(e){"undefined"!=typeof r[e]&&d.css(e,r[e])}),r.center.address?i.getAddress(r.center.address,r.geocoding_api_key).then(function(t){e.extend(r.center,t),u(r,o)}):u(r,o)}function l(){a.__google_api_xmp_map_loaded__&&m&&g()}var m=!1;s.reset=function(){g()},s.$on("map-api-ready",function(){a.__google_api_xmp_map_loaded__=!0,l()}),s.xmpReady(function(){m=!0,l()})}}}])}(angular),function(e){e.module("xmp.app").service("xmpMapAddressesService",["$http","$log","$q",function(e,o,t){var r=function(r,n){var i=t.defer();if(!n){var a="Google developer API key must be specified for addresses service to work.";return o.error(a),void i.reject(a)}return e.get("https://maps.googleapis.com/maps/api/geocode/json?app_key="+n+"&address="+r.replace(/ /g,"+")).then(function(e){if("ZERO_RESULTS"==e.data.status){var t="Google Geocoding API produced no results";return o.error(t),void i.reject(t)}return e.data.results&&e.data.results.length>0?void i.resolve(e.data.results[0].geometry.location):void i.resolve({})},function(e){var t="Error while accessing Google Geocoding: "+e;o.error(t),i.resolve(t)}),i.promise},n=function(e,n){var i=t.defer(),a=[],s=e.length,d=function(o){o&&a.unshift(o),s--,s>-1?r(e[s],n).then(d):i.resolve(a)};if(!n){var p="Google developer API key must be specified for addresses service to work.";return o.error(p),void i.reject(p)}return d(),i.promise};return{getAddress:r,getAddressList:n}}])}(angular),function(e){"use strict";e.module("xmp.app").service("xmpMapDirectionService",["$log","xmpMapMarkersService",function(e,o){var t=function(t,r,n){function i(o,t){t===google.maps.DirectionsStatus.OK?p.setDirections(o):e.error("Directions request failed due to "+t)}function a(e,r){var i={start:new google.maps.MarkerImage(n.start.url,new google.maps.Size(n.start.size.width,n.start.size.height),new google.maps.Point(n.start.origin.x,n.start.origin.y),new google.maps.Point(n.start.anchor.x,n.start.anchor.y)),end:new google.maps.MarkerImage(n.end.url,new google.maps.Size(n.end.size.width,n.end.size.height),new google.maps.Point(n.end.origin.x,n.end.origin.y),new google.maps.Point(n.end.anchor.x,n.end.anchor.y))};if(r==google.maps.DirectionsStatus.OK){p.setDirections(e);var a=e.routes[0].legs[0];o.createMarker(t,a.start_location,i.start),o.createMarker(t,a.end_location,i.end)}}var s={polylineOptions:r.color?{polylineOptions:{strokeColor:r.color}}:void 0,suppressMarkers:n?!0:void 0},d=new google.maps.DirectionsService,p=new google.maps.DirectionsRenderer(s);p.setMap(t),d.route({origin:r.origin,destination:r.destination,travelMode:google.maps.TravelMode.DRIVING},n?a:i)};return{setRoute:t}}])}(angular),function(e){e.module("xmp.app").service("xmpMapMarkersService",function(){var e=function(e,o,t){new google.maps.Marker({position:o,map:e,icon:t?t:void 0})};return{createMarker:e}})}(angular);